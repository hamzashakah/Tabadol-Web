drop database TabadolWeb;

create database TabadolWeb;


CREATE TABLE `schools` (
  `id` int(11) NOT NULL,
  `name` varchar(128) NOT NULL,
  `phone` varchar(16) NOT NULL,
  `manager_name` varchar(128) NOT NULL,
  `location` varchar(128) NOT NULL,
  `school_number` varchar(32) NOT NULL,
  `city` varchar(32) NOT NULL,
  `address` varchar(128) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Indexes for dumped tables
--

--
-- Indexes for table `schools`
--
ALTER TABLE `schools`
  ADD PRIMARY KEY (`id`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `schools`
--
ALTER TABLE `schools`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;











DROP TABLE IF EXISTS `users`;
CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(40) NOT NULL,
  `password` varchar(40) NOT NULL,
  `permission` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;
COMMIT;








DROP TABLE IF EXISTS `requests`;
CREATE TABLE `TabadolWeb`.`requests` ( `id` INT NOT NULL AUTO_INCREMENT , `school_id` INT NOT NULL , `phone` VARCHAR(20) NOT NULL , `name` VARCHAR(40) NOT NULL , `start_time` DATETIME NOT NULL , `end_time` DATETIME NOT NULL , `notes` VARCHAR(256) NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;







DROP TABLE IF EXISTS `request_data`;
CREATE TABLE `TabadolWeb`.`request_data` ( `id` INT NOT NULL AUTO_INCREMENT , `request_id` INT NOT NULL , `dev_type_id` INT NOT NULL , `quantity` INT NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;







DROP TABLE IF EXISTS `dev_types`;
CREATE TABLE `TabadolWeb`.`dev_types` ( `id` INT NOT NULL AUTO_INCREMENT , `name` VARCHAR(32) NOT NULL , `img` VARCHAR(128) NOT NULL , `code` VARCHAR(128) NOT NULL , PRIMARY KEY (`id`) ) ENGINE = InnoDB;






DROP TABLE IF EXISTS `fault_dev`;
CREATE TABLE `TabadolWeb`.`fault_dev` ( `id` INT NOT NULL AUTO_INCREMENT , `dev_type_id` INT NOT NULL , `request_id` INT NOT NULL , `notes` VARCHAR(256) NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;






DROP TABLE IF EXISTS `school_dev_data`;
CREATE TABLE `TabadolWeb`.`school_dev_data` ( `id` INT NOT NULL AUTO_INCREMENT , `school_id` INT NOT NULL , `dev_type_id` INT NOT NULL , `quantity` INT NOT NULL , `notes` VARCHAR(256) NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;





DROP TABLE IF EXISTS `fault_dev_img`;
CREATE TABLE `TabadolWeb`.`fault_dev_img` ( `id` INT NOT NULL AUTO_INCREMENT , `img` VARCHAR(128) NOT NULL , `fault_dev_id` INT NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;









DROP TABLE IF EXISTS `transactions`;
CREATE TABLE `TabadolWeb`.`transactions` ( `id` INT NOT NULL AUTO_INCREMENT , `school_1_id` INT NOT NULL , `school_2_id` INT NOT NULL , `phone_1` VARCHAR(32) NOT NULL , `phone_2` VARCHAR(32) NOT NULL , `name_1` VARCHAR(64) NOT NULL , `name_2` VARCHAR(64) NOT NULL , `start_time` DATETIME NOT NULL , `end_time` DATETIME NOT NULL , `notes` VARCHAR(256) NOT NULL , `request_id` INT NOT NULL , PRIMARY KEY (`id`)) ENGINE = InnoDB;




// add foreign keys

ALTER TABLE `requests` ADD FOREIGN KEY (`school_id`) REFERENCES `schools` (`id`);

ALTER TABLE `request_data` ADD FOREIGN KEY (`request_id`) REFERENCES `requests` (`id`);

ALTER TABLE `request_data` ADD FOREIGN KEY (`dev_type_id`) REFERENCES `dev_types` (`id`);

ALTER TABLE `fault_dev` ADD FOREIGN KEY (`dev_type_id`) REFERENCES `dev_types` (`id`);

ALTER TABLE `fault_dev` ADD FOREIGN KEY (`request_id`) REFERENCES `requests` (`id`);

ALTER TABLE `fault_dev_img` ADD FOREIGN KEY (`fault_dev_id`) REFERENCES `fault_dev` (`id`);

ALTER TABLE `school_dev_data` ADD FOREIGN KEY (`school_id`) REFERENCES `schools` (`id`);

ALTER TABLE `school_dev_data` ADD FOREIGN KEY (`dev_type_id`) REFERENCES `dev_types` (`id`);

ALTER TABLE `transactions` ADD FOREIGN KEY (`school_1_id`) REFERENCES `schools` (`id`);

ALTER TABLE `transactions` ADD FOREIGN KEY (`school_2_id`) REFERENCES `schools` (`id`);

ALTER TABLE `transactions` ADD FOREIGN KEY (`request_id`) REFERENCES `requests` (`id`);



// add default values

INSERT INTO `users` (`id`, `username`, `password`, `permission`) VALUES
(1, 'admin', 'admin', 1);
COMMIT;

